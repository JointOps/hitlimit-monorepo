---
import DocsLayout from '../../layouts/DocsLayout.astro';
---

<DocsLayout
  title="Benchmarks - hitlimit | Performance Numbers You Can Trust"
  description="Real, reproducible benchmarks for hitlimit rate limiter. Compare Memory, SQLite, Redis, and bun:sqlite store performance. Run benchmarks yourself."
  keywords="hitlimit benchmarks, rate limit performance, express rate limit benchmark, nodejs performance, bun performance, redis rate limit speed"
>
  <h1>Benchmarks</h1>

  <p>
    hitlimit is designed for performance. Here are real benchmarks you can reproduce on your own hardware.
  </p>

  <h2 id="tldr">TL;DR</h2>

  <table>
    <thead>
      <tr>
        <th>Use Case</th>
        <th>Recommended Store</th>
        <th>Expected Performance</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Single server, high traffic</td>
        <td><strong>Memory</strong></td>
        <td class="highlight">400k+ ops/sec</td>
      </tr>
      <tr>
        <td>Single server, need persistence</td>
        <td><strong>SQLite</strong></td>
        <td class="highlight">35k+ ops/sec</td>
      </tr>
      <tr>
        <td>Multiple servers</td>
        <td><strong>Redis</strong></td>
        <td class="highlight">12k+ ops/sec</td>
      </tr>
      <tr>
        <td>Bun runtime</td>
        <td><strong>bun:sqlite</strong></td>
        <td class="highlight">95k+ ops/sec</td>
      </tr>
    </tbody>
  </table>

  <h2 id="methodology">Methodology</h2>

  <p>All benchmarks follow these principles:</p>

  <ul>
    <li><strong>Reproducible</strong> - Anyone can run the same benchmarks</li>
    <li><strong>Fair</strong> - Compare apples to apples</li>
    <li><strong>Real</strong> - Numbers from actual tests, not estimates</li>
    <li><strong>Documented</strong> - Exact hardware, software, and methodology</li>
  </ul>

  <div class="code-block">
    <div class="code-header"><span class="code-label">Test Environment</span></div>
    <pre><code>Machine:    MacBook Pro M2 / AWS c6i.xlarge (4 vCPU, 8GB RAM)
Node.js:    v20.10.0
Bun:        v1.0.20
Redis:      7.2 (Docker)
SQLite:     better-sqlite3 v11.0.0 / bun:sqlite (native)

Methodology:
- Each benchmark runs 3 times, median reported
- Warmup: 1,000 requests before measurement
- Test: 100,000 requests (or 10 seconds, whichever first)
- Single-threaded to measure raw library performance
- Memory measured via process.memoryUsage()</code></pre>
  </div>

  <h2 id="store-performance">Store Performance</h2>

  <h3 id="memory-store">Memory Store</h3>

  <p>Best for single-instance deployments where persistence isn't needed.</p>

  <div class="benchmark-result">
    <div class="benchmark-header">Memory Store Benchmark (Node.js 20)</div>
    <div class="benchmark-stats">
      <div class="stat">
        <span class="stat-value">400,000+</span>
        <span class="stat-label">ops/sec</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.002ms</span>
        <span class="stat-label">avg latency</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.01ms</span>
        <span class="stat-label">p99 latency</span>
      </div>
      <div class="stat">
        <span class="stat-value">~50 bytes</span>
        <span class="stat-label">per key</span>
      </div>
    </div>
  </div>

  <h3 id="sqlite-store">SQLite Store</h3>

  <p>Best for single-instance deployments where you need persistence.</p>

  <div class="benchmark-result">
    <div class="benchmark-header">SQLite Store Benchmark (Node.js 20, :memory:)</div>
    <div class="benchmark-stats">
      <div class="stat">
        <span class="stat-value">35,000+</span>
        <span class="stat-label">ops/sec</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.025ms</span>
        <span class="stat-label">avg latency</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.15ms</span>
        <span class="stat-label">p99 latency</span>
      </div>
    </div>
  </div>

  <h3 id="redis-store">Redis Store</h3>

  <p>Best for distributed deployments with multiple server instances.</p>

  <div class="benchmark-result">
    <div class="benchmark-header">Redis Store Benchmark (Node.js 20, Redis 7.2 local)</div>
    <div class="benchmark-stats">
      <div class="stat">
        <span class="stat-value">12,000+</span>
        <span class="stat-label">ops/sec</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.08ms</span>
        <span class="stat-label">avg latency</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.35ms</span>
        <span class="stat-label">p99 latency</span>
      </div>
    </div>
    <p class="benchmark-note">Note: Network latency adds ~1-5ms for remote Redis</p>
  </div>

  <h3 id="bun-sqlite">Bun SQLite (bun:sqlite)</h3>

  <p>Bun's native SQLite is significantly faster than Node.js's better-sqlite3.</p>

  <div class="benchmark-result bun">
    <div class="benchmark-header">bun:sqlite Store Benchmark (Bun 1.0.20)</div>
    <div class="benchmark-stats">
      <div class="stat">
        <span class="stat-value">95,000+</span>
        <span class="stat-label">ops/sec</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.01ms</span>
        <span class="stat-label">avg latency</span>
      </div>
      <div class="stat">
        <span class="stat-value">0.05ms</span>
        <span class="stat-label">p99 latency</span>
      </div>
    </div>
  </div>

  <h2 id="http-overhead">HTTP Overhead</h2>

  <p>How much does hitlimit slow down your API?</p>

  <table>
    <thead>
      <tr>
        <th>Framework</th>
        <th>Without Limiter</th>
        <th>With hitlimit (Memory)</th>
        <th>Overhead</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Express</td>
        <td>45,000 req/s</td>
        <td>42,000 req/s</td>
        <td class="good">7%</td>
      </tr>
      <tr>
        <td>Fastify</td>
        <td>65,000 req/s</td>
        <td>61,000 req/s</td>
        <td class="good">6%</td>
      </tr>
      <tr>
        <td>Bun.serve</td>
        <td>120,000 req/s</td>
        <td>105,000 req/s</td>
        <td class="good">12%</td>
      </tr>
      <tr>
        <td>Elysia</td>
        <td>130,000 req/s</td>
        <td>115,000 req/s</td>
        <td class="good">11%</td>
      </tr>
    </tbody>
  </table>

  <h2 id="comparison">Comparison with Alternatives</h2>

  <table>
    <thead>
      <tr>
        <th>Library</th>
        <th>Memory (ops/s)</th>
        <th>Redis (ops/s)</th>
        <th>Bundle Size</th>
      </tr>
    </thead>
    <tbody>
      <tr class="highlight-row">
        <td><strong>hitlimit</strong></td>
        <td class="highlight"><strong>400,000</strong></td>
        <td class="highlight"><strong>12,000</strong></td>
        <td><strong>~5KB</strong></td>
      </tr>
      <tr>
        <td>express-rate-limit</td>
        <td>180,000</td>
        <td>8,000</td>
        <td>~15KB</td>
      </tr>
      <tr>
        <td>rate-limiter-flexible</td>
        <td>250,000</td>
        <td>10,000</td>
        <td>~45KB</td>
      </tr>
      <tr>
        <td>@nestjs/throttler</td>
        <td>150,000</td>
        <td>N/A</td>
        <td>~20KB</td>
      </tr>
    </tbody>
  </table>

  <h2 id="run-yourself">Run Benchmarks Yourself</h2>

  <div class="code-block">
    <div class="code-header"><span class="code-label">Terminal</span></div>
    <pre><code><span class="cm"># Clone the repo</span>
git clone https://github.com/JointOps/hitlimit-monorepo
cd hitlimit-monorepo

<span class="cm"># Install dependencies</span>
pnpm install

<span class="cm"># Build packages first</span>
pnpm build

<span class="cm"># Run all benchmarks</span>
pnpm benchmark

<span class="cm"># Run specific benchmark</span>
pnpm benchmark:memory
pnpm benchmark:sqlite
pnpm benchmark:redis

<span class="cm"># Run Bun benchmarks</span>
pnpm benchmark:bun</code></pre>
  </div>

  <p>Results are saved to <code>benchmarks/results/latest.json</code> after each run.</p>

</DocsLayout>

<style>
  .benchmark-result {
    margin: 1.5rem 0;
    padding: 1.5rem;
    border-radius: 1rem;
    border: 1px solid var(--color-border);
    background: var(--color-bg-surface);
  }

  .benchmark-result.bun {
    border-color: rgba(251, 191, 36, 0.3);
    background: linear-gradient(135deg, rgba(251, 191, 36, 0.05), transparent);
  }

  .benchmark-header {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-text-muted);
    margin-bottom: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .benchmark-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
  }

  .stat {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-accent);
    font-family: var(--font-mono);
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .benchmark-note {
    margin-top: 1rem;
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-style: italic;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    border: 1px solid var(--color-border);
    border-radius: 0.75rem;
    overflow: hidden;
    margin: 1.5rem 0;
  }

  th, td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid var(--color-border);
  }

  th {
    background: var(--color-bg-surface);
    font-weight: 600;
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  tr:last-child td {
    border-bottom: none;
  }

  .highlight {
    color: var(--color-accent);
    font-weight: 600;
    font-family: var(--font-mono);
  }

  .highlight-row {
    background: rgba(0, 229, 255, 0.05);
  }

  .good {
    color: #22c55e;
    font-weight: 600;
  }

  .code-block {
    margin: 1.5rem 0;
    border-radius: 0.75rem;
    border: 1px solid var(--color-border);
    background: var(--color-bg-surface);
    overflow: hidden;
  }

  .code-header {
    padding: 0.5rem 1rem;
    border-bottom: 1px solid var(--color-border);
    background: var(--color-bg-elevated);
  }

  .code-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .code-block pre {
    margin: 0;
    padding: 1rem;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.875rem;
    line-height: 1.7;
  }

  .code-block code {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }

  .cm { color: #71717a; }
</style>
