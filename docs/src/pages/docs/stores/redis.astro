---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Tabs from '../../../components/Tabs.astro';
---

<DocsLayout
  title="Redis Rate Limiting Store - hitlimit | Distributed Rate Limiter"
  description="Redis store for hitlimit distributed rate limiting. Scale your rate limiter across multiple servers with Redis. ioredis support, cluster mode, and high availability."
  keywords="redis rate limit, redis rate limiter, distributed rate limiting, redis throttle, ioredis rate limit, redis api protection, multi-server rate limit, redis cluster rate limit, redis express rate limit"
>
  <h1>Redis Store</h1>

  <p>The Redis store enables distributed rate limiting across multiple server instances. Essential for horizontally scaled applications.</p>

  <h2 id="installation">Installation</h2>

  <p>The Redis store requires <code>ioredis</code> as a peer dependency:</p>

  <Tabs
    tabs={[
      { label: 'npm', content: 'npm install ioredis' },
      { label: 'pnpm', content: 'pnpm add ioredis' },
      { label: 'yarn', content: 'yarn add ioredis' },
      { label: 'bun', content: 'bun add ioredis' },
    ]}
  />

  <h2 id="usage">Usage</h2>

  <div class="code-block">
    <pre><code><span class="kw">import</span> {"{"} hitlimit {"}"} <span class="kw">from</span> <span class="str">'hitlimit'</span>
<span class="kw">import</span> {"{"} redisStore {"}"} <span class="kw">from</span> <span class="str">'hitlimit/stores/redis'</span>

app.<span class="fn">use</span>(<span class="fn">hitlimit</span>({"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>,
  store: <span class="fn">redisStore</span>({"{"}
    url: <span class="str">'redis://localhost:6379'</span>
  {"}"})
{"}"}))</code></pre>
  </div>

  <h2 id="options">Options</h2>

  <table class="options-table">
    <thead>
      <tr><th>Option</th><th>Type</th><th>Default</th><th>Description</th></tr>
    </thead>
    <tbody>
      <tr><td><code>url</code></td><td>string</td><td>-</td><td>Redis connection URL</td></tr>
      <tr><td><code>client</code></td><td>Redis</td><td>-</td><td>Existing ioredis client instance</td></tr>
      <tr><td><code>prefix</code></td><td>string</td><td>'hitlimit:'</td><td>Key prefix for rate limit entries</td></tr>
    </tbody>
  </table>

  <h2 id="connection-options">Connection Options</h2>

  <p>Connect using a URL:</p>

  <div class="code-block">
    <pre><code><span class="fn">redisStore</span>({"{"}
  url: <span class="str">'redis://:password@hostname:6379/0'</span>
{"}"})</code></pre>
  </div>

  <p>Or use an existing client:</p>

  <div class="code-block">
    <pre><code><span class="kw">import</span> Redis <span class="kw">from</span> <span class="str">'ioredis'</span>

<span class="kw">const</span> redis = <span class="kw">new</span> <span class="fn">Redis</span>({"{"}
  host: <span class="str">'localhost'</span>,
  port: <span class="num">6379</span>,
  password: <span class="str">'secret'</span>,
  db: <span class="num">0</span>
{"}"})

<span class="fn">redisStore</span>({"{"} client: redis {"}"})</code></pre>
  </div>

  <h2 id="cluster-support">Cluster Support</h2>

  <div class="code-block">
    <pre><code><span class="kw">import</span> Redis <span class="kw">from</span> <span class="str">'ioredis'</span>

<span class="kw">const</span> cluster = <span class="kw">new</span> Redis.<span class="fn">Cluster</span>([
  {"{"} host: <span class="str">'node1'</span>, port: <span class="num">6379</span> {"}"},
  {"{"} host: <span class="str">'node2'</span>, port: <span class="num">6379</span> {"}"},
  {"{"} host: <span class="str">'node3'</span>, port: <span class="num">6379</span> {"}"}
])

<span class="fn">redisStore</span>({"{"} client: cluster {"}"})</code></pre>
  </div>

  <h2 id="characteristics">Characteristics</h2>

  <ul>
    <li><strong>Speed:</strong> Fast with low latency</li>
    <li><strong>Persistence:</strong> Configurable via Redis settings</li>
    <li><strong>Scalability:</strong> Shared across all server instances</li>
    <li><strong>Atomic:</strong> Uses Lua scripts for race-condition-free increments</li>
  </ul>

  <h2 id="when-to-use">When to Use</h2>

  <ul>
    <li>Multi-server/container deployments</li>
    <li>Kubernetes or Docker Swarm clusters</li>
    <li>High-traffic applications</li>
    <li>When consistent rate limiting across instances is required</li>
  </ul>
</DocsLayout>

<style>
  .options-table { width: 100%; margin: 1.5rem 0; border-collapse: collapse; border: 1px solid var(--color-border); border-radius: 0.75rem; overflow: hidden; }
  .options-table th { background: var(--color-bg-surface); text-align: left; padding: 0.75rem 1rem; font-size: 0.875rem; color: var(--color-text-muted); border-bottom: 1px solid var(--color-border); }
  .options-table td { padding: 0.75rem 1rem; border-bottom: 1px solid var(--color-border); color: var(--color-text-secondary); }
  .options-table tr:last-child td { border-bottom: none; }
  .options-table code { background: var(--color-bg-elevated); color: var(--color-accent); padding: 0.2em 0.4em; border-radius: 4px; font-size: 0.875em; }
  .code-block { margin: 1rem 0; border-radius: 0.75rem; border: 1px solid var(--color-border); background: var(--color-bg-surface); overflow: hidden; }
  .code-block pre { margin: 0; padding: 1rem; overflow-x: auto; font-family: var(--font-mono); font-size: 0.875rem; line-height: 1.7; }
  .code-block code { background: none !important; border: none !important; padding: 0 !important; }
  .kw { color: #c792ea; } .str { color: #a6e22e; } .num { color: #fd971f; } .fn { color: #66d9ef; } .cm { color: #71717a; }
</style>
