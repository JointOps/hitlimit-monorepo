---
import DocsLayout from '../../../layouts/DocsLayout.astro';
import Tabs from '../../../components/Tabs.astro';
---

<DocsLayout
  title="Fastify Rate Limit Plugin - hitlimit | Best Fastify Rate Limiter"
  description="Fastify rate limiting plugin with hitlimit. Protect your Fastify APIs with high-performance rate limiting - route-specific limits, custom keys, Redis/SQLite stores. fastify-rate-limit alternative."
  keywords="fastify rate limit, fastify rate limiter, fastify plugin rate limiting, fastify-rate-limit alternative, fastify api protection, fastify brute force protection, fastify throttle, fastify middleware"
>
  <h1>Fastify Adapter</h1>

  <p>The Fastify adapter provides seamless integration with Fastify applications through a native plugin using the <code>onRequest</code> hook.</p>

  <h2 id="installation">Installation</h2>

  <Tabs
    tabs={[
      { label: 'npm', content: 'npm install @joint-ops/hitlimit fastify fastify-plugin' },
      { label: 'pnpm', content: 'pnpm add @joint-ops/hitlimit fastify fastify-plugin' },
      { label: 'yarn', content: 'yarn add @joint-ops/hitlimit fastify fastify-plugin' },
      { label: 'bun', content: 'bun add @joint-ops/hitlimit fastify fastify-plugin' },
    ]}
  />

  <h2 id="basic-usage">Basic Usage</h2>

  <p>Register hitlimit as a Fastify plugin:</p>

  <div class="code-block">
    <div class="code-header"><span class="code-label">app.ts</span></div>
    <pre><code><span class="kw">import</span> Fastify <span class="kw">from</span> <span class="str">'fastify'</span>
<span class="kw">import</span> {"{"} hitlimit {"}"} <span class="kw">from</span> <span class="str">'@joint-ops/hitlimit/fastify'</span>

<span class="kw">const</span> app = <span class="fn">Fastify</span>()

<span class="cm">// Apply to all routes</span>
<span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>
{"}"})

app.<span class="fn">get</span>(<span class="str">'/'</span>, () => <span class="str">'Hello'</span>)

<span class="kw">await</span> app.<span class="fn">listen</span>({"{"} port: <span class="num">3000</span> {"}"})</code></pre>
  </div>

  <h2 id="route-specific">Route-Specific Rate Limiting</h2>

  <p>Use Fastify's encapsulated plugin system to apply different limits per route prefix:</p>

  <div class="code-block">
    <div class="code-header"><span class="code-label">routes.ts</span></div>
    <pre><code><span class="cm">// Strict limit on /api routes</span>
app.<span class="fn">register</span>(<span class="kw">async</span> (scope) => {"{"}
  <span class="kw">await</span> scope.<span class="fn">register</span>(hitlimit, {"{"}
    limit: <span class="num">100</span>,
    window: <span class="str">'1m'</span>
  {"}"})
  scope.<span class="fn">get</span>(<span class="str">'/users'</span>, handler)
{"}"}, {"{"} prefix: <span class="str">'/api'</span> {"}"})

<span class="cm">// Tight limit on auth routes</span>
app.<span class="fn">register</span>(<span class="kw">async</span> (scope) => {"{"}
  <span class="kw">await</span> scope.<span class="fn">register</span>(hitlimit, {"{"}
    limit: <span class="num">5</span>,
    window: <span class="str">'15m'</span>
  {"}"})
  scope.<span class="fn">post</span>(<span class="str">'/login'</span>, handler)
{"}"}, {"{"} prefix: <span class="str">'/auth'</span> {"}"})</code></pre>
  </div>

  <h2 id="custom-key">Custom Key Extraction</h2>

  <p>Rate limit by user ID, API key, or custom identifiers:</p>

  <div class="code-block">
    <pre><code><span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>,
  key: (request) => {"{"}
    <span class="cm">// Rate limit by API key or fall back to IP</span>
    <span class="kw">return</span> request.headers[<span class="str">'x-api-key'</span>] || request.ip
  {"}"}
{"}"})</code></pre>
  </div>

  <h2 id="skip-requests">Skipping Requests</h2>

  <p>Bypass rate limiting for certain requests:</p>

  <div class="code-block">
    <pre><code><span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>,
  skip: (request) => {"{"}
    <span class="cm">// Skip health checks</span>
    <span class="kw">return</span> request.url === <span class="str">'/health'</span>
  {"}"}
{"}"})</code></pre>
  </div>

  <h2 id="custom-response">Custom Error Response</h2>

  <p>Customize the response when rate limit is exceeded:</p>

  <div class="code-block">
    <pre><code><span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>,
  response: (info) => ({"{"}
    error: <span class="str">'Rate limit exceeded'</span>,
    retryIn: info.resetIn
  {"}"})
{"}"})</code></pre>
  </div>

  <h2 id="with-stores">Using with Stores</h2>

  <p>Use Redis or SQLite for distributed rate limiting:</p>

  <div class="code-block">
    <pre><code><span class="kw">import</span> {"{"} hitlimit {"}"} <span class="kw">from</span> <span class="str">'@joint-ops/hitlimit/fastify'</span>
<span class="kw">import</span> {"{"} redisStore {"}"} <span class="kw">from</span> <span class="str">'@joint-ops/hitlimit/stores/redis'</span>

<span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>,
  store: <span class="fn">redisStore</span>({"{"}
    url: <span class="str">'redis://localhost:6379'</span>
  {"}"})
{"}"})</code></pre>
  </div>

  <h2 id="migrating">Migrating from @fastify/rate-limit</h2>

  <p>Switching from <code>@fastify/rate-limit</code> to hitlimit is straightforward. Both use Fastify's plugin system.</p>

  <div class="code-block">
    <div class="code-header"><span class="code-label">Before (@fastify/rate-limit)</span></div>
    <pre><code><span class="kw">import</span> rateLimit <span class="kw">from</span> <span class="str">'@fastify/rate-limit'</span>

<span class="kw">await</span> app.<span class="fn">register</span>(rateLimit, {"{"}
  max: <span class="num">100</span>,
  timeWindow: <span class="str">'1 minute'</span>
{"}"})</code></pre>
  </div>

  <div class="code-block">
    <div class="code-header"><span class="code-label">After (hitlimit)</span></div>
    <pre><code><span class="kw">import</span> {"{"} hitlimit {"}"} <span class="kw">from</span> <span class="str">'@joint-ops/hitlimit/fastify'</span>

<span class="kw">await</span> app.<span class="fn">register</span>(hitlimit, {"{"}
  limit: <span class="num">100</span>,
  window: <span class="str">'1m'</span>
{"}"})</code></pre>
  </div>

  <div class="migration-table">
    <table>
      <thead>
        <tr>
          <th>@fastify/rate-limit</th>
          <th>hitlimit</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><code>max: 100</code></td>
          <td><code>limit: 100</code></td>
        </tr>
        <tr>
          <td><code>timeWindow: '1 minute'</code></td>
          <td><code>window: '1m'</code></td>
        </tr>
        <tr>
          <td><code>keyGenerator: (req) => ...</code></td>
          <td><code>key: (req) => ...</code></td>
        </tr>
        <tr>
          <td><code>errorResponseBuilder: (req, ctx) => ...</code></td>
          <td><code>response: (info) => ...</code></td>
        </tr>
        <tr>
          <td>No built-in tiered limits</td>
          <td><code>tiers: {"{"} free: ..., pro: ... {"}"}</code></td>
        </tr>
        <tr>
          <td>No built-in SQLite store</td>
          <td><code>store: sqliteStore()</code></td>
        </tr>
      </tbody>
    </table>
  </div>

  <p>See the <a href="/docs/comparison#vs-fastify-rate-limit">full comparison</a> for more details.</p>

  <h2 id="next-steps">Next Steps</h2>

  <ul>
    <li><a href="/docs/configuration/options">Configuration Options</a> - All available options</li>
    <li><a href="/docs/stores/overview">Stores</a> - Memory, SQLite, Redis</li>
    <li><a href="/docs/adapters/express">Express Adapter</a> - Express.js integration</li>
  </ul>
</DocsLayout>

<style>
  .code-block { margin: 1rem 0; border-radius: 0.75rem; border: 1px solid var(--color-border); background: var(--color-bg-surface); overflow: hidden; }
  .code-header { padding: 0.5rem 1rem; border-bottom: 1px solid var(--color-border); background: var(--color-bg-elevated); }
  .code-label { font-size: 0.75rem; color: var(--color-text-muted); font-family: var(--font-mono); }
  .code-block pre { margin: 0; padding: 1rem; overflow-x: auto; font-family: var(--font-mono); font-size: 0.875rem; line-height: 1.7; }
  .code-block code { background: none !important; border: none !important; padding: 0 !important; }
  .kw { color: #c792ea; } .str { color: #a6e22e; } .num { color: #fd971f; } .fn { color: #66d9ef; } .cm { color: #71717a; }
  .migration-table { margin: 1.5rem 0; overflow-x: auto; }
  .migration-table table { width: 100%; border-collapse: separate; border-spacing: 0; border: 1px solid var(--color-border); border-radius: 0.75rem; overflow: hidden; font-size: 0.875rem; }
  .migration-table th { background: var(--color-bg-surface); text-align: left; padding: 0.75rem 1rem; font-weight: 600; color: var(--color-text-muted); border-bottom: 1px solid var(--color-border); }
  .migration-table td { padding: 0.75rem 1rem; border-bottom: 1px solid var(--color-border); color: var(--color-text-secondary); }
  .migration-table tr:last-child td { border-bottom: none; }
  .migration-table code { background: var(--color-bg-elevated); color: var(--color-accent); padding: 0.2em 0.4em; border-radius: 4px; font-size: 0.875em; }
</style>
