---
import DocsLayout from '../../../layouts/DocsLayout.astro';
---

<DocsLayout
  title="Real-World Examples - hitlimit | Production Rate Limiting Patterns"
  description="Production-ready rate limiting examples for SaaS, e-commerce, authentication, social platforms, and gaming backends. Copy-paste code for Express, NestJS, Bun, and Elysia."
  keywords="rate limit examples, express rate limit example, nestjs rate limit example, api rate limiting patterns, production rate limiting, saas rate limit, ecommerce rate limit"
>
  <h1>Real-World Examples</h1>

  <p>
    Production-ready rate limiting patterns for common use cases. Each example includes complete,
    copy-paste ready code with explanations of why limits are set as they are.
  </p>

  <h2 id="quick-start">Quick Start Examples</h2>

  <p>For simple use cases, here are one-liner setups:</p>

  <div class="code-block">
    <div class="code-header"><span class="code-label">Express - One Liner</span></div>
    <pre><code><span class="kw">import</span> {"{"} hitlimit {"}"} <span class="kw">from</span> <span class="str">'@joint-ops/hitlimit'</span>

app.<span class="fn">use</span>(<span class="fn">hitlimit</span>()) <span class="cm">// 100 requests per minute per IP</span></code></pre>
  </div>

  <div class="code-block">
    <div class="code-header"><span class="code-label">NestJS - One Liner</span></div>
    <pre><code><span class="kw">@Module</span>({"{"}
  imports: [<span class="fn">HitLimitModule</span>.<span class="fn">register</span>({"{"} limit: <span class="num">100</span>, window: <span class="str">'1m'</span> {"}"})]
{"}"})
<span class="kw">export class</span> AppModule {"{}"}</code></pre>
  </div>

  <div class="code-block">
    <div class="code-header"><span class="code-label">Bun - One Liner</span></div>
    <pre><code>Bun.<span class="fn">serve</span>({"{"}
  fetch: <span class="fn">hitlimit</span>({"{}"}, (req) => <span class="kw">new</span> <span class="fn">Response</span>(<span class="str">'Hello!'</span>))
{"}"})</code></pre>
  </div>

  <h2 id="industry-examples">Industry Examples</h2>

  <div class="example-grid">
    <a href="/docs/examples/saas" class="example-card">
      <div class="example-icon saas">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
          <line x1="9" y1="3" x2="9" y2="21"/>
          <line x1="3" y1="9" x2="21" y2="9"/>
        </svg>
      </div>
      <h3>SaaS API</h3>
      <p>Tiered limits by subscription plan (free/pro/enterprise)</p>
      <span class="tag">Express</span>
      <span class="tag">NestJS</span>
      <span class="tag">Redis</span>
    </a>

    <a href="/docs/examples/auth" class="example-card">
      <div class="example-icon auth">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
      </div>
      <h3>Authentication</h3>
      <p>Login protection, 2FA, brute force prevention</p>
      <span class="tag">Security</span>
      <span class="tag">Redis</span>
    </a>

    <a href="/docs/examples/ecommerce" class="example-card">
      <div class="example-icon ecommerce">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="9" cy="21" r="1"/>
          <circle cx="20" cy="21" r="1"/>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
        </svg>
      </div>
      <h3>E-Commerce</h3>
      <p>Cart abuse prevention, checkout protection</p>
      <span class="tag">Express</span>
      <span class="tag">Redis</span>
    </a>

    <a href="/docs/examples/social" class="example-card">
      <div class="example-icon social">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
      </div>
      <h3>Social Platform</h3>
      <p>Posts, comments, follows, and DM limits</p>
      <span class="tag">Tiered</span>
      <span class="tag">Redis</span>
    </a>

    <a href="/docs/examples/gaming" class="example-card bun">
      <div class="example-icon gaming">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="6" width="20" height="12" rx="2"/>
          <circle cx="8" cy="12" r="2"/>
          <line x1="14" y1="10" x2="14" y2="14"/>
          <line x1="12" y1="12" x2="16" y2="12"/>
        </svg>
      </div>
      <h3>Gaming Backend</h3>
      <p>Matchmaking, leaderboards, chat (Bun)</p>
      <span class="tag">Bun</span>
      <span class="tag">High Performance</span>
    </a>

    <a href="/docs/examples/cinema" class="example-card">
      <div class="example-icon cinema">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"/>
          <line x1="7" y1="2" x2="7" y2="22"/>
          <line x1="17" y1="2" x2="17" y2="22"/>
          <line x1="2" y1="12" x2="22" y2="12"/>
          <line x1="2" y1="7" x2="7" y2="7"/>
          <line x1="2" y1="17" x2="7" y2="17"/>
          <line x1="17" y1="17" x2="22" y2="17"/>
          <line x1="17" y1="7" x2="22" y2="7"/>
        </svg>
      </div>
      <h3>Cinema Booking</h3>
      <p>Seat selection, ticket scalping prevention</p>
      <span class="tag">Session</span>
      <span class="tag">Redis</span>
    </a>
  </div>

  <h2 id="common-patterns">Common Patterns</h2>

  <h3>Tiered Rate Limits</h3>

  <div class="code-block">
    <pre><code><span class="fn">hitlimit</span>({"{"}
  tiers: {"{"}
    free: {"{"} limit: <span class="num">100</span>, window: <span class="str">'1h'</span> {"}"},
    pro: {"{"} limit: <span class="num">5000</span>, window: <span class="str">'1h'</span> {"}"},
    enterprise: {"{"} limit: <span class="num">Infinity</span> {"}"}
  {"}"},
  tier: (req) => req.user?.plan || <span class="str">'free'</span>
{"}"})</code></pre>
  </div>

  <h3>Rate Limit by Workspace (Not User)</h3>

  <div class="code-block">
    <pre><code><span class="fn">hitlimit</span>({"{"}
  key: (req) => {"{"}
    <span class="cm">// All users in same workspace share limits</span>
    <span class="kw">return</span> <span class="str">`workspace:</span>${"{"}req.user?.workspaceId{"}"}<span class="str">`</span>
  {"}"}
{"}"})</code></pre>
  </div>

  <h3>Fail Open vs Fail Closed</h3>

  <div class="code-block">
    <pre><code><span class="fn">hitlimit</span>({"{"}
  onStoreError: (error, req) => {"{"}
    <span class="cm">// Critical endpoints should fail closed (deny)</span>
    <span class="kw">if</span> (req.path.includes(<span class="str">'/billing'</span>)) <span class="kw">return</span> <span class="str">'deny'</span>

    <span class="cm">// Non-critical endpoints can fail open (allow)</span>
    <span class="kw">return</span> <span class="str">'allow'</span>
  {"}"}
{"}"})</code></pre>
  </div>

  <h3>Skip Internal Services</h3>

  <div class="code-block">
    <pre><code><span class="fn">hitlimit</span>({"{"}
  skip: (req) => {"{"}
    <span class="cm">// Skip health checks</span>
    <span class="kw">if</span> (req.path === <span class="str">'/health'</span>) <span class="kw">return</span> <span class="kw">true</span>

    <span class="cm">// Skip internal service calls</span>
    <span class="kw">if</span> (req.headers[<span class="str">'x-internal-service'</span>] === process.env.SECRET) {"{"}
      <span class="kw">return</span> <span class="kw">true</span>
    {"}"}

    <span class="kw">return</span> <span class="kw">false</span>
  {"}"}
{"}"})</code></pre>
  </div>

</DocsLayout>

<style>
  .example-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1rem;
    margin: 2rem 0;
  }

  .example-card {
    display: block;
    padding: 1.5rem;
    border-radius: 1rem;
    border: 1px solid var(--color-border);
    background: var(--color-bg-surface);
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .example-card:hover {
    transform: translateY(-4px);
    border-color: rgba(0, 229, 255, 0.3);
    box-shadow: 0 8px 32px rgba(0, 229, 255, 0.1);
  }

  .example-card.bun {
    border-color: rgba(251, 191, 36, 0.2);
  }

  .example-card.bun:hover {
    border-color: rgba(251, 191, 36, 0.5);
    box-shadow: 0 8px 32px rgba(251, 191, 36, 0.1);
  }

  .example-icon {
    width: 3rem;
    height: 3rem;
    border-radius: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 1rem;
    background: rgba(0, 229, 255, 0.1);
    color: var(--color-accent);
  }

  .example-icon.auth {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
  }

  .example-icon.ecommerce {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
  }

  .example-icon.social {
    background: rgba(168, 85, 247, 0.1);
    color: #a855f7;
  }

  .example-icon.gaming {
    background: rgba(251, 191, 36, 0.1);
    color: #fbbf24;
  }

  .example-icon.cinema {
    background: rgba(236, 72, 153, 0.1);
    color: #ec4899;
  }

  .example-icon svg {
    width: 1.5rem;
    height: 1.5rem;
  }

  .example-card h3 {
    font-size: 1.125rem;
    font-weight: 600;
    color: white;
    margin: 0 0 0.5rem 0;
  }

  .example-card p {
    font-size: 0.875rem;
    color: var(--color-text-secondary);
    margin: 0 0 1rem 0;
    line-height: 1.5;
  }

  .tag {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    font-size: 0.6875rem;
    font-weight: 500;
    border-radius: 0.375rem;
    background: rgba(255, 255, 255, 0.05);
    color: var(--color-text-muted);
    margin-right: 0.25rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .code-block {
    margin: 1.5rem 0;
    border-radius: 0.75rem;
    border: 1px solid var(--color-border);
    background: var(--color-bg-surface);
    overflow: hidden;
  }

  .code-header {
    padding: 0.5rem 1rem;
    border-bottom: 1px solid var(--color-border);
    background: var(--color-bg-elevated);
  }

  .code-label {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    font-family: var(--font-mono);
  }

  .code-block pre {
    margin: 0;
    padding: 1rem;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.875rem;
    line-height: 1.7;
  }

  .code-block code {
    background: none !important;
    border: none !important;
    padding: 0 !important;
  }

  .kw { color: #c792ea; }
  .str { color: #a6e22e; }
  .num { color: #fd971f; }
  .fn { color: #66d9ef; }
  .cm { color: #71717a; }
</style>
